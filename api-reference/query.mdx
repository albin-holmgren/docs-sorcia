---
title: Query API
description: 'Search your knowledge base with AI-powered queries'
---

## Overview

The Query API is Sorcia's core endpoint for searching your knowledge base. It uses hybrid search (vector + text) and AI to provide accurate, cited answers to natural language questions.

<Info>
  **Base URL**: `https://api.sorcia.ai/api/ai/query`  
  **Method**: `POST`  
  **Authentication**: Required (Bearer token or API key)
</Info>

## Quick Example

<CodeGroup>

```bash cURL
curl -X POST https://api.sorcia.ai/api/ai/query \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "What is our vacation policy?"
  }'
```

```javascript JavaScript
const response = await fetch('https://api.sorcia.ai/api/ai/query', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    question: 'What is our vacation policy?'
  })
});

const result = await response.json();
console.log(result.answer);
```

```python Python
import requests

response = requests.post(
    'https://api.sorcia.ai/api/ai/query',
    headers={'Authorization': f'Bearer {access_token}'},
    json={'question': 'What is our vacation policy?'}
)

result = response.json()
print(result['answer'])
```

```typescript TypeScript
interface QueryRequest {
  question: string;
  filters?: {
    sources?: string[];
    dateRange?: { start: string; end: string };
  };
  options?: {
    limit?: number;
    stream?: boolean;
  };
}

const query = async (question: string): Promise<QueryResponse> => {
  const response = await fetch('https://api.sorcia.ai/api/ai/query', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ question })
  });
  
  return response.json();
};
```

</CodeGroup>

## Request Parameters

### Required Parameters

<ParamField body="question" type="string" required>
  The question or search query in natural language
  
  **Example**: "How do I submit expense reports?"
</ParamField>

### Optional Parameters

<ParamField body="filters" type="object">
  Filters to narrow search results
  
  <Expandable title="Filter Options">
    <ParamField body="sources" type="string[]">
      Limit search to specific integrations
      
      **Example**: `["slack", "notion"]`
    </ParamField>
    
    <ParamField body="dateRange" type="object">
      Filter by document update date
      
      <ParamField body="start" type="string">
        ISO 8601 date string
      </ParamField>
      <ParamField body="end" type="string">
        ISO 8601 date string
      </ParamField>
    </ParamField>
    
    <ParamField body="channels" type="string[]">
      Slack channels to search (if source includes Slack)
    </ParamField>
    
    <ParamField body="authors" type="string[]">
      Filter by document authors/creators
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="options" type="object">
  Query behavior options
  
  <Expandable title="Options">
    <ParamField body="limit" type="number" default="8">
      Maximum number of source documents to retrieve (1-20)
    </ParamField>
    
    <ParamField body="stream" type="boolean" default="false">
      Stream the response as Server-Sent Events
    </ParamField>
    
    <ParamField body="includeMetadata" type="boolean" default="true">
      Include full document metadata in citations
    </ParamField>
    
    <ParamField body="temperature" type="number" default="0.7">
      AI creativity (0-1, lower is more deterministic)
    </ParamField>
  </Expandable>
</ParamField>

## Response Format

### Success Response (200)

```json
{
  "answer": "Based on your Employee Handbook, all full-time employees receive 20 days of paid time off (PTO) per year...",
  "confidence": 0.95,
  "citations": [
    {
      "id": "doc_123",
      "title": "Employee Handbook 2024",
      "source": "google-drive",
      "url": "https://drive.google.com/file/d/abc123",
      "snippet": "All full-time employees receive 20 days of paid time off...",
      "relevance": 0.92,
      "metadata": {
        "author": "HR Team",
        "updated_at": "2024-01-15T10:00:00Z",
        "file_type": "pdf"
      }
    }
  ],
  "related_questions": [
    "How do I request time off?",
    "Can I roll over unused vacation days?",
    "What's the policy for sick leave?"
  ],
  "query_metadata": {
    "query_id": "qry_abc123",
    "response_time_ms": 1247,
    "sources_searched": 847,
    "sources_used": 3
  }
}
```

### Response Fields

<ResponseField name="answer" type="string">
  AI-generated answer based on retrieved documents
</ResponseField>

<ResponseField name="confidence" type="number">
  Confidence score (0-1) indicating answer quality
</ResponseField>

<ResponseField name="citations" type="array">
  Source documents used to generate the answer
  
  <Expandable title="Citation Object">
    <ResponseField name="id" type="string">
      Unique document identifier
    </ResponseField>
    
    <ResponseField name="title" type="string">
      Document title
    </ResponseField>
    
    <ResponseField name="source" type="string">
      Integration source (e.g., "slack", "notion")
    </ResponseField>
    
    <ResponseField name="url" type="string">
      Direct link to the original document
    </ResponseField>
    
    <ResponseField name="snippet" type="string">
      Relevant excerpt from the document
    </ResponseField>
    
    <ResponseField name="relevance" type="number">
      Relevance score (0-1)
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="related_questions" type="string[]">
  Suggested follow-up questions
</ResponseField>

<ResponseField name="query_metadata" type="object">
  Query performance and statistics
</ResponseField>

## Advanced Usage

### Filtering by Source

Search only specific integrations:

```javascript
const response = await fetch('https://api.sorcia.ai/api/ai/query', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    question: 'Latest product roadmap updates',
    filters: {
      sources: ['notion', 'github'],
      dateRange: {
        start: '2024-01-01',
        end: '2024-12-31'
      }
    }
  })
});
```

### Streaming Responses

For real-time answer generation, use streaming:

<CodeGroup>

```javascript JavaScript (Fetch)
const response = await fetch('https://api.sorcia.ai/api/ai/query', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    question: 'Explain our security architecture',
    options: { stream: true }
  })
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  
  const chunk = decoder.decode(value);
  const lines = chunk.split('\n');
  
  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const data = JSON.parse(line.slice(6));
      console.log(data.delta); // Incremental text
    }
  }
}
```

```python Python
import requests

response = requests.post(
    'https://api.sorcia.ai/api/ai/query',
    headers={'Authorization': f'Bearer {access_token}'},
    json={
        'question': 'Explain our security architecture',
        'options': {'stream': True}
    },
    stream=True
)

for line in response.iter_lines():
    if line.startswith(b'data: '):
        data = json.loads(line[6:])
        print(data['delta'], end='', flush=True)
```

</CodeGroup>

### Server-Sent Events Format

```
data: {"delta": "Based on ", "done": false}

data: {"delta": "your Security ", "done": false}

data: {"delta": "Policy...", "done": false}

data: {"done": true, "citations": [...]}
```

## Error Responses

### Bad Request (400)

```json
{
  "error": "Bad Request",
  "message": "Question is required",
  "code": "MISSING_QUESTION"
}
```

**Common Causes**:
- Missing `question` parameter
- Invalid filter format
- Malformed JSON

### Unauthorized (401)

```json
{
  "error": "Unauthorized",
  "message": "Invalid or expired token"
}
```

**Solution**: Refresh your access token

### Rate Limited (429)

```json
{
  "error": "Rate Limit Exceeded",
  "message": "Too many requests",
  "retry_after": 60
}
```

**Solution**: Implement exponential backoff

### No Results (200)

```json
{
  "answer": "I couldn't find any relevant information about that in your knowledge base.",
  "confidence": 0.0,
  "citations": [],
  "related_questions": []
}
```

<Warning>
  A `200` status with empty citations means no relevant documents were found, not an error.
</Warning>

## Rate Limits

Query API limits by plan:

| Plan | Queries/Month | Queries/Minute |
|------|---------------|----------------|
| Free | 100 | 5 |
| Pro | 1,000 | 20 |
| Enterprise | Unlimited | 100 |

<Tip>
  Monitor usage via the `X-RateLimit-*` response headers
</Tip>

## Best Practices

<AccordionGroup>
  <Accordion title="Write Clear Questions">
    - Use natural language
    - Be specific (e.g., "Q4 2024 sales metrics" vs "sales")
    - Include context when needed
    - Avoid overly broad questions
  </Accordion>
  
  <Accordion title="Use Filters Wisely">
    - Filter by source when you know where info lives
    - Use date ranges for time-sensitive queries
    - Combine filters for precision
  </Accordion>
  
  <Accordion title="Handle Low Confidence">
    - Confidence < 0.5: Show warning to users
    - Confidence < 0.3: Suggest refining question
    - Always show citations so users can verify
  </Accordion>
  
  <Accordion title="Cache Results">
    - Cache identical queries for 5-10 minutes
    - Use query_id for deduplication
    - Invalidate cache on document updates
  </Accordion>
  
  <Accordion title="Implement Retry Logic">
    - Retry on 5xx errors with exponential backoff
    - Don't retry on 4xx errors (client errors)
    - Set maximum retry limit (e.g., 3 attempts)
  </Accordion>
</AccordionGroup>

## Code Examples

### React Hook

```typescript
import { useState } from 'react';

export function useQuery() {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const query = async (question: string) => {
    setLoading(true);
    setError(null);
    
    try {
      const response = await fetch('https://api.sorcia.ai/api/ai/query', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${getAccessToken()}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ question })
      });
      
      if (!response.ok) {
        throw new Error('Query failed');
      }
      
      return await response.json();
    } catch (err) {
      setError(err.message);
      throw err;
    } finally {
      setLoading(false);
    }
  };
  
  return { query, loading, error };
}
```

### Python Client

```python
class SorciaClient:
    def __init__(self, access_token):
        self.access_token = access_token
        self.base_url = 'https://api.sorcia.ai'
    
    def query(self, question, **kwargs):
        """Query the knowledge base"""
        response = requests.post(
            f'{self.base_url}/api/ai/query',
            headers={'Authorization': f'Bearer {self.access_token}'},
            json={'question': question, **kwargs}
        )
        response.raise_for_status()
        return response.json()
    
    def query_with_retry(self, question, max_retries=3):
        """Query with automatic retry on failure"""
        for attempt in range(max_retries):
            try:
                return self.query(question)
            except requests.exceptions.RequestException as e:
                if attempt == max_retries - 1:
                    raise
                time.sleep(2 ** attempt)  # Exponential backoff
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Webhooks" icon="webhook" href="/api-reference/webhooks">
    Receive real-time updates
  </Card>
  <Card title="Documents API" icon="file" href="/api-reference/documents">
    Manage documents programmatically
  </Card>
</CardGroup>
